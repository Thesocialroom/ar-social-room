<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Social Style Studio | AR Try-On</title>
    
    <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mind-ar@1.1.4/dist/mindar-face-aframe.prod.js"></script>
    <script src="https://unpkg.com/peerjs@1.4.7/dist/peerjs.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>

    <style>
        :root { --accent: #ff0055; --dark: #0a0a0a; }
        body { background-color: var(--dark); color: white; overflow: hidden; }
        
        /* Glassmorphism Sidebar */
        .glass-panel {
            background: rgba(20, 20, 20, 0.7);
            backdrop-filter: blur(15px);
            border-right: 1px solid rgba(255,255,255,0.1);
        }

        /* The Runway Grid */
        #runway-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            height: 100vh;
            width: 100%;
        }

        .user-slot { border: 1px solid rgba(255,255,255,0.05); position: relative; overflow: hidden; }
        
        /* Button Glow */
        .btn-style {
            transition: 0.3s;
            background: rgba(255,255,255,0.05);
        }
        .btn-style:hover { background: var(--accent); transform: scale(1.05); }

        /* AR Video positioning */
        video { object-fit: cover !important; }
    </style>
</head>
<body>

    <div class="fixed inset-y-0 left-0 w-80 glass-panel z-50 p-6 flex flex-col">
        <h1 class="text-2xl font-black tracking-tighter mb-8 italic">STYLE.STUDIO</h1>
        
        <div class="flex-1 overflow-y-auto">
            <p class="text-xs font-bold text-gray-400 uppercase tracking-widest mb-4">Real-World Pieces</p>
            
            <div class="mb-4 group">
                <div class="relative rounded-xl overflow-hidden bg-white/5 p-2">
                    <img src="https://images.clothes-site.com/item1-png.png" class="w-full h-32 object-contain">
                    <div class="absolute inset-0 bg-black/60 opacity-0 group-hover:opacity-100 flex items-center justify-center gap-2 transition-opacity">
                        <button onclick="applyToSelf('glasses')" class="p-2 bg-white text-black text-xs font-bold rounded">TRY</button>
                        <a href="https://www.zara.com/sample" target="_blank" class="p-2 bg-pink-600 text-white text-xs font-bold rounded">BUY</a>
                    </div>
                </div>
                <div class="mt-2 flex justify-between items-center">
                    <span class="text-sm font-medium">Gold Aviators</span>
                    <span class="text-[10px] text-gray-500 uppercase">Zara</span>
                </div>
            </div>
            </div>

        <div class="pt-6 border-t border-white/10 flex gap-4">
            <button onclick="shareStudio()" class="flex-1 py-3 btn-style rounded-full text-xs font-bold">SHARE LINK</button>
            <button onclick="captureMoment()" class="w-12 h-12 rounded-full border border-white/20 flex items-center justify-center">ðŸ“¸</button>
        </div>
    </div>

    <div id="runway-container">
        <div id="local-user" class="user-slot">
            <div class="absolute top-4 left-4 z-10 px-3 py-1 bg-pink-600 text-[10px] font-bold rounded-full">YOU</div>
            <a-scene mindar-face="autoStart: true;" embedded vr-mode-ui="enabled: false">
                <a-camera active="false" position="0 0 0"></a-camera>
                <a-entity mindar-face-target="anchorIndex: 168">
                    <a-image id="self-glasses" src="path/to/glasses.png" visible="false" scale="0.6 0.3 1"></a-image>
                </a-entity>
            </a-scene>
        </div>
        </div>

    <script>
        let peer;
        let myRoomId = window.location.hash || `#studio-${Math.floor(Math.random()*10000)}`;
        if(!window.location.hash) window.location.hash = myRoomId;

        // 1. PeerJS Connection Setup
        peer = new Peer();
        peer.on('open', id => {
            console.log("Connected as: " + id);
            // In a real app, you'd signal a signaling server here
        });

        // 2. Peer "Exchange" Logic
        // When User A clicks an item, we send a 'data' packet via PeerJS
        function applyToFriend(friendPeerId, itemId) {
            const conn = peer.connect(friendPeerId);
            conn.on('open', () => {
                conn.send({ type: 'STYLE_CHANGE', item: itemId });
            });
        }

        peer.on('connection', conn => {
            conn.on('data', data => {
                if(data.type === 'STYLE_CHANGE') {
                    toggleAR(data.item); // Changes your outfit based on friend's choice
                }
            });
        });

        // 3. AR Toggle Logic
        function applyToSelf(id) {
            const el = document.querySelector(`#self-${id}`);
            el.setAttribute('visible', !el.getAttribute('visible'));
        }

        // 4. Social Sharing
        async function shareStudio() {
            try {
                await navigator.share({
                    title: 'Join my AR Style Studio',
                    url: window.location.href
                });
            } catch (err) {
                navigator.clipboard.writeText(window.location.href);
                alert("Studio Link Copied!");
            }
        }

        // 5. Screenshot Logic
        function captureMoment() {
            const scene = document.querySelector('a-scene');
            const canvas = scene.components.screenshot.getCanvas('perspective');
            const link = document.createElement('a');
            link.download = 'style-studio-capture.png';
            link.href = canvas.toDataURL();
            link.click();
        }
    </script>
</body>
</html>